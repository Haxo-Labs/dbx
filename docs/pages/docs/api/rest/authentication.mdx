# Authentication

DBX provides multiple authentication methods to secure your API endpoints. Choose the method that best fits your security requirements and deployment environment.

## Overview

Authentication in DBX is designed to be flexible and secure, supporting both simple and advanced authentication patterns suitable for edge and embedded systems.

## Authentication Methods

### 1. API Key Authentication

The simplest form of authentication using an API key in the request headers.

```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
     http://localhost:8080/api/string/my-key
```

**Configuration:**

```bash
export DBX_API_KEY=your-secret-api-key
```

### 2. Basic Authentication

Standard HTTP Basic Authentication using username and password.

```bash
curl -u username:password \
     http://localhost:8080/api/string/my-key
```

**Configuration:**

```bash
export DBX_BASIC_AUTH_USERNAME=admin
export DBX_BASIC_AUTH_PASSWORD=secure-password
```

### 3. JWT Authentication

JSON Web Token authentication for stateless authentication.

```bash
curl -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
     http://localhost:8080/api/string/my-key
```

**Configuration:**

```bash
export DBX_JWT_SECRET=your-jwt-secret
export DBX_JWT_ISSUER=dbx
export DBX_JWT_AUDIENCE=dbx-api
```

## Security Headers

DBX automatically includes security headers in responses:

- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: DENY`
- `X-XSS-Protection: 1; mode=block`
- `Strict-Transport-Security: max-age=31536000; includeSubDomains`

## Rate Limiting

API requests are rate-limited to prevent abuse:

- **Default:** 100 requests per minute per IP
- **Configurable:** Via `DBX_RATE_LIMIT_REQUESTS` and `DBX_RATE_LIMIT_WINDOW`

```bash
export DBX_RATE_LIMIT_REQUESTS=1000
export DBX_RATE_LIMIT_WINDOW=60
```

## CORS Configuration

Configure Cross-Origin Resource Sharing for web applications:

```bash
export DBX_CORS_ORIGINS="https://yourdomain.com,https://app.yourdomain.com"
export DBX_CORS_METHODS="GET,POST,PUT,DELETE,OPTIONS"
export DBX_CORS_HEADERS="Content-Type,Authorization"
```

## Error Responses

Authentication errors return appropriate HTTP status codes:

```json
{
  "error": "unauthorized",
  "message": "Invalid API key",
  "status": 401
}
```

## Best Practices

1. **Use HTTPS in production** - Always use TLS encryption
2. **Rotate API keys regularly** - Implement key rotation policies
3. **Use environment variables** - Never hardcode credentials
4. **Implement proper logging** - Monitor authentication attempts
5. **Use strong secrets** - Generate cryptographically secure keys

## Environment Variables Reference

| Variable                  | Description                    | Default                       |
| ------------------------- | ------------------------------ | ----------------------------- |
| `DBX_API_KEY`             | API key for Bearer token auth  | -                             |
| `DBX_BASIC_AUTH_USERNAME` | Username for Basic auth        | -                             |
| `DBX_BASIC_AUTH_PASSWORD` | Password for Basic auth        | -                             |
| `DBX_JWT_SECRET`          | Secret for JWT signing         | -                             |
| `DBX_JWT_ISSUER`          | JWT issuer claim               | `dbx`                         |
| `DBX_JWT_AUDIENCE`        | JWT audience claim             | `dbx-api`                     |
| `DBX_RATE_LIMIT_REQUESTS` | Rate limit requests per window | `100`                         |
| `DBX_RATE_LIMIT_WINDOW`   | Rate limit window in seconds   | `60`                          |
| `DBX_CORS_ORIGINS`        | Allowed CORS origins           | `*`                           |
| `DBX_CORS_METHODS`        | Allowed CORS methods           | `GET,POST,PUT,DELETE,OPTIONS` |
| `DBX_CORS_HEADERS`        | Allowed CORS headers           | `Content-Type,Authorization`  |
